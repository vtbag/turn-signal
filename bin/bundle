#! /bin/sh

if [ "$1" = "dev" ]; then
  OPTS="--sourcemap --watch"
elif [ "$1" = "test" ]; then
  OPTS="--sourcemap"
else
  OPTS="--minify"
  (cd lib && rm *.js.map) >> /dev/null 2>&1
fi
npx esbuild src/index.ts src/forced-traversal.ts src/link-types.ts --bundle $OPTS --target=ESnext --outdir=lib

cp lib/*.js lib/*.map tests
tsc
